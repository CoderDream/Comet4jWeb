<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Comet4J Hello World</title>
<script type="text/javascript" src="js/comet4j.js"></script>
<script type="text/javascript">
	function getMeasureValue(comPort) {
		var kbDom = document.getElementById('kb');
		//alert('COM Port: ' + comPort.value);
		
		JS.Engine.on({
			measure : function(kb) {//侦听一个channel
				//var freeMemory = kb.freeMemory;
				//alert(kb.COM1);
				//alert(kb.COM2);
				//alert(kb.COM3);
				//alert('kb: ' + kb);
				var json = eval("(" + kb + ")");
				//alert('json: ' + json);
				if(comPort.value == 'COM1') {
					//alert('COM1: ' + comPort.value);
					kbDom.innerHTML = 'COM1: ' + json.COM1;
							
				} else if(comPort.value == 'COM2') {
					//alert('COM2: ' + comPort.value);
					kbDom.innerHTML = 'COM2: ' + json.COM2;
				} else if(comPort.value == 'COM3') {
					//alert('COM3: ' + comPort.value);
					kbDom.innerHTML = 'COM3: ' + json.COM3;
				} else if(comPort.value == 'COM4') {
					//alert('COM3: ' + comPort.value);
					kbDom.innerHTML = json.COM4;
				} else if(comPort.value == 'COM5') {
					//alert('COM5: ' + comPort.value);
					kbDom.innerHTML = json.COM5;
				}
			}
		});
		JS.Engine.start('conn');	
	}
</script>
</head>
<body>
	衡器实时重量：
	<span id="kb">...............</span>&nbsp;&nbsp;KG <br />
	<form method="post" action="">
		<select name="" onchange="getMeasureValue(this)">
			<option value="COM1" 
				selected="selected">COM1</option>
			<option value="COM2">COM2</option>
			<option value="COM3">COM3</option>
			<option value="COM4">COM4</option>
			<option value="COM5">COM5</option>
		</select>
	</form>
</body>
</html>